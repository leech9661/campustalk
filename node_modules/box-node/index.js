var BoxNode;

BoxNode = (function () {
  var levelup = require('levelup')
    , db = levelup('/does/not/matter', { db: require('memdown') })
    , Promise = require("bluebird")
    , crypto = require("crypto");

  function BoxNode() { }

  function keySha(key) {
    key = key.toString();
    var keyShaSum = crypto.createHash("sha256").update(key).digest("hex");

    return keyShaSum;
  }

  BoxNode.set = function (key, value) {
    return new Promise(function (resolve, reject) {
      if (!key || !value) {
        throw new Error("expected a key and a value")
      }

      var keyShaSum = keySha(key);

      db.put(keyShaSum, value, function (err) {
        if (err) {
          reject(err);
          return;
        }

        resolve();
      });
    });
  };

  BoxNode.get = function (key) {
    return new Promise(function (resolve, reject) {
      if (!key) {
        throw new Error("exptected a key");
      }

      var keyShaSum = keySha(key);

      db.get(keyShaSum, function (err, value) {
        if (err) {
          reject(err);
          return;
        }

        resolve(value);
      });
    });
  };

  return BoxNode;

})();

module.exports = new BoxNode();
